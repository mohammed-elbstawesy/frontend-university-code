import { Component, inject } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';
import { Router, RouterLink } from '@angular/router';
import { VulnService } from '../../../../core/services/vuln.service'; 

@Component({
  selector: 'app-add-vulnerability',
  standalone: true,
  imports: [CommonModule, FormsModule, RouterLink],
  templateUrl: './add-vulnerability.html',
  styles: []
})
export class AddVulnerability {
  private _vulnService = inject(VulnService);
  router = inject(Router);

 vulnData = {
    title: '',
    smallDescription: '', 
    description: '',
    severity: 'low',
    scriptFile: '', // 1. غيرنا الاسم هنا من url لـ scriptFile
    status: 'available'
  };

 onSubmit() {
    const capitalize = (s: string) => s && s.charAt(0).toUpperCase() + s.slice(1);

    const payload = {
      name: this.vulnData.title,
      smallDescription: this.vulnData.smallDescription,
      description: this.vulnData.description,
      severity: capitalize(this.vulnData.severity),
      
      scriptFile: this.vulnData.scriptFile, // 2. بنبعت المتغير الجديد مباشرة
      
      isActive: this.vulnData.status === 'available',
      date: new Date().toISOString()
    };

  console.log('Sending Payload:', payload); 

  
  this._vulnService.createVuln(payload).subscribe({
    next: (res) => {
      console.log('Success:', res);
      alert('Vulnerability added successfully!');
      this.router.navigate(['/dashboard/vulnerabilities']);
    },
    error: (err) => {
      console.error('Error:', err);
      alert('Failed: ' + (err.error?.message || err.statusText)); 
    }
  });
}











// updateVuln() {
//   // 1. جهز البيانات الجديدة من الفورم
//   const updatedData: Vulnerability = {
//     name: this.vulnForm.value.name,
//     description: this.vulnForm.value.description,
//     severity: this.vulnForm.value.severity,
//     date: this.vulnForm.value.date,
//     // ... باقي الحقول
//   };

//   const id = 'هنا_تحط_الـ_ID_بتاع_العنصر'; // مثلا this.currentVulnId

//   // 2. استدعي السيرفس
//   this._vulnService.editVulnerability(id, updatedData).subscribe({
//     next: (response) => {
//       console.log('Update Successful', response);
//       alert(response.message); // هيطبع "Vulnerability updated successfully"
//       // هنا ممكن تقفل الـ Modal أو ترجع للصفحة الرئيسية
//     },
//     error: (err) => {
//       console.error('Update Failed', err);
//     }
//   });
// }
}